<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Austen &amp; Scott ‚Äî Library Admin (Prototype)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#07131a;
      --card:#0f2328;
      --muted:#9aa8ad;
      --gold:#b8954a;
      --accent:#d8c68a;
      --glass: rgba(255,255,255,0.04);
      --radius:14px;
      --ease: cubic-bezier(.2,.9,.3,1);
      --max-width:1200px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg), #041014 140%);
      color:#eaf6f5;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.35;
    }

    .app{
      max-width:var(--max-width);
      margin:28px auto;
      padding:28px;
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:28px;
    }

    .sidebar{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      min-height:540px;
      box-shadow: 0 6px 18px rgba(2,6,8,0.6);
      display:flex;
      flex-direction:column;
      gap:16px;
      align-items:stretch;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:6px;
    }
    .brand .logo{
      width:44px; height:44px; border-radius:8px; background:linear-gradient(180deg,var(--gold),#866f34); display:flex; align-items:center; justify-content:center; font-family:"Playfair Display"; font-weight:700; color:#07131a;
      box-shadow:0 4px 14px rgba(184,148,74,0.14);
    }
    .brand h1{font-family:"Playfair Display"; font-size:18px; margin:0; letter-spacing:0.6px}
    .brand p{margin:0; font-size:12px; color:var(--muted)}

    .nav{
      display:flex; flex-direction:column; gap:8px; margin-top:6px;
    }
    .nav button{
      display:flex; align-items:center; gap:12px; background:transparent; border:0; color:inherit; padding:10px; border-radius:10px; cursor:pointer; text-align:left; font-weight:600;
    }
    .nav button.active, .nav button:hover{
      background:linear-gradient(90deg, rgba(184,148,74,0.12), rgba(255,255,255,0.01));
      color:var(--accent);
      transform:translateX(2px);
    }

    .search {
      margin-top:8px;
      background:var(--glass);
      border-radius:12px;
      padding:8px;
      display:flex; gap:8px; align-items:center;
    }
    .search input{background:transparent;border:0;outline:0;color:inherit;font-size:14px;width:100%}

    .main{
      min-height:540px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
    }
    .topbar .welcome{
      font-family:"Playfair Display";
      font-size:20px;
    }
    .top-actions{display:flex; gap:12px; align-items:center}
    .icon-btn{
      background:var(--glass); border:0; padding:10px 12px; border-radius:10px; cursor:pointer; color:inherit;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:16px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.018), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:14px;
      box-shadow:0 8px 22px rgba(2,6,8,0.45);
    }
    .stat{
      display:flex; justify-content:space-between; gap:12px; align-items:center;
    }
    .stat h3{margin:0;font-size:22px;font-weight:700}
    .muted{color:var(--muted); font-size:13px}

    .progress{
      height:8px; background:rgba(255,255,255,0.04); border-radius:999px; overflow:hidden; margin-top:10px;
    }
    .progress > i{display:block; height:100%; background:linear-gradient(90deg,var(--gold), #f9e6b7); width:40%}

    .carousel{
      display:flex; gap:12px; align-items:center; overflow:auto; padding-bottom:8px;
    }
    .book-thumb{width:120px; min-width:120px; border-radius:8px; background:linear-gradient(180deg,#d9c99a,#b5953f); height:170px; display:flex; align-items:flex-end; padding:10px; color:#07131a; font-weight:700; font-family:"Playfair Display"; box-shadow:0 8px 26px rgba(3,8,10,0.6)}
    .book-thumb img{width:100%; height:100%; object-fit:cover; border-radius:6px; display:block}

    .table{width:100%; border-collapse:collapse; margin-top:8px;}
    .table thead th{font-weight:600; font-size:13px; color:var(--muted); text-align:left; padding:10px 8px}
    .table tbody td{padding:12px 8px; border-top:1px solid rgba(255,255,255,0.03)}
    .chip{padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}
    .chip.returned{background:rgba(98,185,131,0.12); color:#cbedcf}
    .chip.active{background:rgba(130,170,240,0.08); color:#cfe3ff}
    .chip.overdue{background:rgba(230,120,120,0.12); color:#ffd7d7}

    .full{
      grid-column:1 / -1;
    }

    .modal-backdrop{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6)); z-index:120}
    .modal{background:linear-gradient(180deg, #08181b, #0c2a2c); width:min(820px,92%); border-radius:14px; padding:18px; box-shadow:0 18px 48px rgba(2,6,8,0.7); color:inherit}
    .modal .row{display:flex; gap:12px}
    .form-field{display:flex; flex-direction:column; gap:8px; margin-bottom:10px}
    label{font-size:13px; color:var(--muted)}
    input[type="text"], textarea, select{
      background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); padding:10px; border-radius:10px; color:inherit; outline:none;
    }
    .btn{
      border:0; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700;
    }
    .btn.primary{background:linear-gradient(90deg,var(--gold), #f8eac0); color:#07131a}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted)}

    .book-detail{
      display:flex; gap:20px; align-items:flex-start;
    }
    .cover{width:180px; height:260px; border-radius:8px; overflow:hidden; flex-shrink:0; background:linear-gradient(180deg,#d9c99a,#b5953f)}
    .meta h2{font-family:"Playfair Display"; margin:0 0 6px 0}
    .meta p{margin:0; color:var(--muted)}

    .auth-screen{
      min-height:100vh; display:flex; align-items:center; justify-content:center; background-image:linear-gradient(180deg, rgba(0,0,0,0.36), rgba(0,0,0,0.45));
      padding:32px;
    }
    .auth-card{width:420px; background:linear-gradient(180deg,#071a1d,#071821); border-radius:16px; padding:22px; box-shadow:0 20px 50px rgba(2,6,8,0.7)}
    .auth-card h3{margin:0 0 8px 0; font-family:"Playfair Display"}
    .hero{display:flex; gap:12px; align-items:center}

    .loading-screen{min-height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:18px}
    .logo-large{font-family:"Playfair Display"; font-size:56px; color:var(--gold)}
    .loader{width:72px;height:72px;border-radius:50%;border:6px solid rgba(255,255,255,0.04); border-top-color:var(--gold); animation:spin 1.4s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:1000px){
      .app{grid-template-columns: 1fr; padding:18px}
      .grid{grid-template-columns: repeat(1,1fr)}
      .carousel{justify-content:flex-start}
      .sidebar{order:2}
      .main{order:1}
      .brand h1{font-size:16px}
    }
    @media (max-width:520px){
      .book-thumb{width:84px; height:120px; min-width:84px}
      .cover{width:120px;height:180px}
    }
  </style>
</head>
<body>

<!-- LOADING SCREEN -->
<section id="loading" class="loading-screen" aria-hidden="false">
  <div class="logo-large">A&amp;A</div>
  <div class="loader" aria-hidden="true"></div>
  <div class="muted">Welcome to the Library Admin</div>
  <div style="margin-top:12px">
    <button class="btn primary" onclick="app.showLogin()">Enter</button>
  </div>
</section>

<!-- LOGIN SCREEN -->
<section id="login" class="auth-screen" style="display:none">
  <div class="auth-card" role="dialog" aria-labelledby="signinTitle">
    <div class="hero">
      <div style="flex:1">
        <h3 id="signinTitle">Sign in to Austen &amp; Scott</h3>
        <p class="muted">Librarian access ¬∑ dashboard & inventory</p>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end">
        <div style="width:48px;height:48px;border-radius:8px;background:linear-gradient(180deg,var(--gold), #7e642b); display:flex; align-items:center; justify-content:center; color:#07131a; font-family:'Playfair Display'">A&amp;A</div>
      </div>
    </div>

    <form onsubmit="event.preventDefault(); app.signIn()" style="margin-top:16px; display:flex; flex-direction:column; gap:12px">
      <div class="form-field">
        <label for="uEmail">Email</label>
        <input id="uEmail" type="text" placeholder="librarian@library.org" required>
      </div>
      <div class="form-field">
        <label for="uPass">Password</label>
        <input id="uPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
      </div>
      <div style="display:flex; gap:10px; justify-content:space-between; align-items:center;">
        <button class="btn primary" type="submit">Sign in</button>
        <button class="btn ghost" type="button" onclick="app.showLoading()">Back</button>
      </div>
    </form>
  </div>
</section>

<!-- APP WRAPPER -->
<main id="app" class="app" style="display:none">

  <!-- SIDEBAR -->
  <aside class="sidebar" aria-label="Main navigation">
    <div class="brand">
      <div class="logo">A&amp;A</div>
      <div>
        <h1>Austen &amp; Scott</h1>
        <p class="muted">Library Admin</p>
      </div>
    </div>

    <div class="search" role="search">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="rgba(255,255,255,0.7)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="rgba(255,255,255,0.7)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <input id="globalSearch" placeholder="Search books, members..." oninput="app.search(this.value)">
    </div>

    <nav class="nav" role="navigation" aria-label="Sections">
      <button class="active" data-page="dashboard" onclick="app.goto(event)">Dashboard</button>
      <button data-page="books" onclick="app.goto(event)">Books</button>
      <button data-page="members" onclick="app.goto(event)">Members</button>
      <button data-page="transactions" onclick="app.goto(event)">Transactions</button>
      <button data-page="settings" onclick="app.goto(event)">Settings</button>
    </nav>

    <div style="margin-top:auto; display:flex; gap:8px; align-items:center; justify-content:space-between;">
      <div style="display:flex; gap:8px; align-items:center">
        <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg,#1b3536,#123535);display:flex;align-items:center;justify-content:center">J</div>
        <div>
          <div style="font-weight:700">Jane Librarian</div>
          <div class="muted" style="font-size:12px">Admin</div>
        </div>
      </div>
      <button class="icon-btn" title="Sign out" onclick="app.signOut()">‚èª</button>
    </div>
  </aside>

  <!-- MAIN -->
  <section class="main" id="mainContent" aria-live="polite">
    <div class="topbar">
      <div>
        <div class="welcome">Welcome Back, <span style="font-weight:700">Jane</span></div>
        <div class="muted" style="font-size:13px">Overview of your library</div>
      </div>

      <div class="top-actions">
        <button class="icon-btn" onclick="app.showAddBook()">+ Add Book</button>
        <button class="icon-btn" id="themeBtn" onclick="app.toggleTheme()">Theme</button>
        <button class="icon-btn" title="Notifications">üîî</button>
      </div>
    </div>

    <!-- DASHBOARD -->
    <section id="dashboardPage">
      <div class="grid">
        <div class="card">
          <div class="stat">
            <div>
              <h3 id="totalBooks">1,240</h3>
              <div class="muted">Total Books</div>
            </div>
            <div style="text-align:right">
              <div style="font-size:14px; color:var(--muted)">On Loan</div>
              <div style="font-weight:800; font-size:20px">184</div>
            </div>
          </div>
          <div style="margin-top:10px" class="muted">Quick availability snapshot</div>
          <div class="progress"><i style="width:14%"></i></div>
        </div>

        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <h3>Member Activity</h3>
              <div class="muted">Active this month</div>
            </div>
            <div style="font-weight:800">342</div>
          </div>
          <div style="margin-top:12px" class="muted">Recent sign-ins & checkouts</div>
          <ul style="margin-top:12px; padding:0; list-style:none">
            <li class="muted" style="margin-bottom:8px">‚Ä¢ Jane Doe borrowed <strong>Frankenstein</strong> ‚Äî 2 days ago</li>
            <li class="muted">‚Ä¢ John Smith returned <strong>The Fourth Wing</strong> ‚Äî 1 day ago</li>
          </ul>
        </div>

        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <h3>Top Rated</h3>
              <div class="muted">Ratings leaderboard</div>
            </div>
            <div style="font-weight:800">Avg 4.3 ‚òÖ</div>
          </div>
          <div style="margin-top:12px" class="carousel" id="topRated">
            <!-- thumbnails inserted by JS -->
          </div>
        </div>
      </div>

      <div style="margin-top:18px; display:grid; grid-template-columns: 2fr 1fr; gap:16px">
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <h3 style="margin:0">Recent Transactions</h3>
              <div class="muted">Checkouts, returns & overdue</div>
            </div>
            <div class="muted">Last 7 days</div>
          </div>

          <table class="table" aria-label="Recent transactions">
            <thead>
              <tr><th>Book</th><th>Member</th><th>Due</th><th>Status</th></tr>
            </thead>
            <tbody id="recentTx">
              <!-- populated by JS -->
            </tbody>
          </table>
        </div>

        <div class="card">
          <h3 style="margin:0">Most Borrowed</h3>
          <div class="muted" style="margin-top:6px">This month</div>

          <ol style="margin-top:12px; padding-left:16px">
            <li class="muted" style="margin-bottom:8px"><strong>The Fourth Wing</strong> ‚Äî 42 borrows</li>
            <li class="muted" style="margin-bottom:8px"><strong>Her Body and Other Parties</strong> ‚Äî 28 borrows</li>
            <li class="muted"><strong>Frankenstein</strong> ‚Äî 21 borrows</li>
          </ol>
        </div>
      </div>

    </section>

    <!-- BOOKS PAGE -->
    <section id="booksPage" style="display:none">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <h3 style="margin:0">Books Inventory</h3>
            <div class="muted">Manage catalog, edit metadata & view history</div>
          </div>
          <div style="display:flex; gap:8px; align-items:center">
            <select id="filterGenre" onchange="app.filterBooks()">
              <option value="">All genres</option>
              <option>Fiction</option>
              <option>Classics</option>
              <option>Fantasy</option>
              <option>Short Stories</option>
            </select>
            <button class="btn ghost" onclick="app.showAddBook()">+ Add</button>
          </div>
        </div>

        <table class="table" style="margin-top:12px">
          <thead>
            <tr><th>#</th><th>Title</th><th>Author</th><th>Availability</th><th>Rating</th><th></th></tr>
          </thead>
          <tbody id="booksTable">
            <!-- populated by JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- MEMBERS PAGE -->
    <section id="membersPage" style="display:none">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <h3 style="margin:0">Members</h3>
            <div class="muted">View, edit member profiles & fines</div>
          </div>
          <div>
            <button class="btn ghost" onclick="app.addMember()">+ Add member</button>
          </div>
        </div>

        <table class="table" style="margin-top:12px">
          <thead><tr><th>#</th><th>Name</th><th>ID</th><th>Loans</th><th>Status</th><th></th></tr></thead>
          <tbody id="membersTable"></tbody>
        </table>
      </div>
    </section>

    <!-- TRANSACTIONS PAGE -->
    <section id="transactionsPage" style="display:none">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <h3 style="margin:0">Transactions</h3>
            <div class="muted">Complete history of checkouts & returns</div>
          </div>
          <div>
            <button class="btn ghost" onclick="app.exportTx()">Export</button>
          </div>
        </div>

        <table class="table" style="margin-top:12px">
          <thead><tr><th>Date</th><th>Book</th><th>Member</th><th>Due</th><th>Status</th></tr></thead>
          <tbody id="txTable"></tbody>
        </table>
      </div>
    </section>

    <!-- SETTINGS PAGE -->
    <section id="settingsPage" style="display:none">
      <div class="card">
        <h3 style="margin:0">Settings</h3>
        <div class="muted" style="margin-top:8px">Library profile & administration</div>

        <div style="margin-top:12px">
          <label class="muted">Library name</label>
          <input type="text" value="Austen &amp; Scott Public Library" style="width:100%; margin-top:6px;">
        </div>

        <div style="display:flex; gap:12px; margin-top:12px; align-items:center">
          <label class="muted">Theme</label>
          <button class="btn ghost" onclick="app.toggleTheme()">Toggle Dark / Light</button>
        </div>
      </div>
    </section>

  </section>
</main>

<!-- MODAL: Add Book -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div style="display:flex; justify-content:space-between; align-items:center">
      <h3 id="modalTitle">Add new book</h3>
      <button class="btn ghost" onclick="app.closeModal()">Close</button>
    </div>

    <form onsubmit="event.preventDefault(); app.addBookSubmit()" style="margin-top:12px">
      <div class="row" style="gap:10px">
        <div style="flex:1">
          <div class="form-field"><label>Title</label><input id="newTitle" type="text" required></div>
          <div class="form-field"><label>Author</label><input id="newAuthor" type="text" required></div>
          <div class="form-field"><label>Genre</label><input id="newGenre" type="text"></div>
        </div>

        <div style="width:220px">
          <div class="form-field"><label>ISBN</label><input id="newISBN" type="text"></div>
          <div class="form-field"><label>Copies</label><input id="newCopies" type="text" value="1"></div>
        </div>
      </div>

      <div class="form-field"><label>Description</label><textarea id="newDesc" rows="3"></textarea></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
        <button class="btn ghost" type="button" onclick="app.closeModal()">Cancel</button>
        <button class="btn primary" type="submit">Add Book</button>
      </div>
    </form>
  </div>
</div>

<!-- BOOK DETAIL SLIDE-IN -->
<aside id="bookDetailPanel" class="modal-backdrop" style="align-items:flex-end; justify-content:flex-end; display:none;">
  <div class="modal" style="width:min(520px,96%); margin:20px; border-radius:12px;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div style="display:flex; gap:12px; align-items:center;">
        <div class="cover" id="detailCover"></div>
        <div class="meta">
          <h2 id="detailTitle">Title</h2>
          <div class="muted" id="detailAuthor">Author</div>
        </div>
      </div>
      <div>
        <button class="btn ghost" onclick="app.closeBookDetail()">Close</button>
      </div>
    </div>

    <div style="margin-top:12px">
      <div style="display:flex; gap:12px; align-items:center">
        <div style="display:flex; gap:6px; align-items:center;">
          <strong id="detailRating">4.2</strong>
          <div class="muted">‚òÖ</div>
        </div>
        <div class="muted" id="detailAvail">Available</div>
      </div>

      <p class="muted" id="detailDesc" style="margin-top:12px"></p>

      <h4 style="margin-top:12px">Loan history</h4>
      <ul id="detailHistory" class="muted" style="margin-top:8px"></ul>

      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px">
        <button class="btn ghost" onclick="app.editBook()">Edit</button>
        <button class="btn primary" onclick="app.checkoutBook()">Checkout</button>
      </div>
    </div>
  </div>
</aside>

<script>
  const app = {
    data: {
      books: [
        { id:1, title:"The Fourth Wing", author:"Rebecca Yarros", genre:"Fantasy", copies:4, rating:4.4, borrows:42, desc:"A best-selling fantasy with soaring stakes."},
        { id:2, title:"Her Body and Other Parties", author:"Carmen Maria Machado", genre:"Short Stories", copies:2, rating:4.1, borrows:28, desc:"A collection blending horror, surrealism & feminist themes."},
        { id:3, title:"Frankenstein", author:"Mary Shelley", genre:"Classics", copies:1, rating:4.6, borrows:21, desc:"Gothic classic exploring creation and responsibility."},
      ],
      members: [
        {id:101, name:"Jane Doe", loans:2, status:"active"},
        {id:102, name:"John Smith", loans:0, status:"active"},
        {id:103, name:"Maya Lee", loans:1, status:"suspended"},
      ],
      tx: [
        {date:"2025-11-15", book:"The Fourth Wing", member:"John Smith", due:"2025-12-05", status:"returned"},
        {date:"2025-11-16", book:"Frankenstein", member:"Jane Doe", due:"2025-12-06", status:"active"},
        {date:"2025-11-16", book:"Her Body and Other Parties", member:"Maya Lee", due:"2025-11-25", status:"overdue"},
      ]
    },

    init(){
      this.populateTopRated();
      this.populateRecentTx();
      this.populateBooksTable();
      this.populateMembers();
      this.populateTxTable();
      document.getElementById('totalBooks').textContent = this.data.books.reduce((s,b)=>s+b.copies,0);
      this.current = 'dashboard';
    },

    goto(e){
      const page = e.currentTarget.dataset.page;
      document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
      e.currentTarget.classList.add('active');
      this.showPage(page);
    },
    showPage(name){
      ['dashboard','books','members','transactions','settings'].forEach(k=>{
        const el = document.getElementById(k + 'Page');
        if(el) el.style.display = (k===name ? '' : 'none');
      });
      this.current = name;
    },

    search(q){
      q = String(q || '').trim().toLowerCase();
      if(!q){ this.populateBooksTable(); this.populateMembers(); return; }
      const books = this.data.books.filter(b=> (b.title + ' ' + b.author + ' ' + b.genre).toLowerCase().includes(q));
      const members = this.data.members.filter(m=> m.name.toLowerCase().includes(q));
      this.renderBooksRows(books);
      this.renderMembersRows(members);
    },

    populateTopRated(){
      const el = document.getElementById('topRated');
      el.innerHTML = '';
      const sorted = [...this.data.books].sort((a,b)=>b.rating-a.rating);
      sorted.forEach(b=>{
        const node = document.createElement('div');
        node.className = 'book-thumb';
        node.innerHTML = `<div style="padding:10px">${escapeHtml(b.title)}</div>`;
        node.onclick = ()=> this.openBookDetail(b.id);
        el.appendChild(node);
      });
    },

    populateRecentTx(){
      const tbody = document.getElementById('recentTx');
      tbody.innerHTML = '';
      this.data.tx.slice(0,6).forEach(t=>{
        const tr = document.createElement('tr');
        const statusClass = (t.status==='returned') ? 'returned' : (t.status==='active' ? 'active' : 'overdue');
        tr.innerHTML = `<td style="width:45%"><strong>${escapeHtml(t.book)}</strong></td>
                        <td>${escapeHtml(t.member)}</td>
                        <td>${escapeHtml(t.due)}</td>
                        <td><span class="chip ${statusClass}">${escapeHtml(t.status)}</span></td>`;
        tbody.appendChild(tr);
      });
    },

    populateBooksTable(){
      this.renderBooksRows(this.data.books);
    },
    renderBooksRows(books){
      const tbody = document.getElementById('booksTable');
      tbody.innerHTML = '';
      books.forEach((b,i)=>{
        const tr = document.createElement('tr');
        const availabilityHtml = b.copies > 0
          ? `<span class="chip active">Available</span>`
          : `<span class="chip overdue">Unavailable</span>`;
        tr.innerHTML = `<td style="width:36px">${i+1}</td>
                        <td><strong>${escapeHtml(b.title)}</strong></td>
                        <td>${escapeHtml(b.author)}</td>
                        <td>${availabilityHtml}</td>
                        <td>${escapeHtml(String(b.rating))} ‚òÖ</td>
                        <td style="text-align:right"><button class="btn ghost" onclick="app.openBookDetail(${b.id})">View</button></td>`;
        tbody.appendChild(tr);
      });
    },

    filterBooks(){
      const g = document.getElementById('filterGenre').value;
      if(!g) return this.populateBooksTable();
      const filtered = this.data.books.filter(b=> b.genre.toLowerCase().includes(g.toLowerCase()));
      this.renderBooksRows(filtered);
    },

    populateMembers(){
      this.renderMembersRows(this.data.members);
    },
    renderMembersRows(members){
      const tbody = document.getElementById('membersTable');
      tbody.innerHTML = '';
      members.forEach((m,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td>
                        <td>${escapeHtml(m.name)}</td>
                        <td>${escapeHtml(String(m.id))}</td>
                        <td>${escapeHtml(String(m.loans))}</td>
                        <td>${escapeHtml(m.status)}</td>
                        <td style="text-align:right"><button class="btn ghost" onclick="app.viewMember(${m.id})">View</button></td>`;
        tbody.appendChild(tr);
      });
    },

    populateTxTable(){
      const tbody = document.getElementById('txTable');
      tbody.innerHTML = '';
      this.data.tx.forEach(t=>{
        const statusClass = (t.status==='returned') ? 'returned' : (t.status==='active' ? 'active' : 'overdue');
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${escapeHtml(t.date)}</td><td>${escapeHtml(t.book)}</td><td>${escapeHtml(t.member)}</td><td>${escapeHtml(t.due)}</td><td><span class="chip ${statusClass}">${escapeHtml(t.status)}</span></td>`;
        tbody.appendChild(tr);
      });
    },

    showAddBook(){
      const el = document.getElementById('modalBackdrop');
      el.style.display = 'flex';
      el.setAttribute('aria-hidden','false');
    },
    closeModal(){
      const el = document.getElementById('modalBackdrop');
      el.style.display = 'none';
      el.setAttribute('aria-hidden','true');
    },
    addBookSubmit(){
      const title = document.getElementById('newTitle').value.trim();
      const author = document.getElementById('newAuthor').value.trim();
      const genre = document.getElementById('newGenre').value.trim() || 'General';
      const copies = parseInt(document.getElementById('newCopies').value || '1',10);
      const desc = document.getElementById('newDesc').value.trim();
      if(!title || !author) return alert('Please provide title & author');
      const id = Math.max(0,...this.data.books.map(b=>b.id)) + 1;
      this.data.books.push({id, title, author, genre, copies, rating:4.0, borrows:0, desc});
      this.closeModal();
      this.populateTopRated();
      this.populateBooksTable();
      alert('Book added (demo)');
    },

    openBookDetail(id){
      const b = this.data.books.find(x=>x.id===id);
      if(!b) return;
      document.getElementById('detailTitle').textContent = b.title;
      document.getElementById('detailAuthor').textContent = b.author;
      document.getElementById('detailRating').textContent = b.rating;
      document.getElementById('detailDesc').textContent = b.desc || '‚Äî';
      document.getElementById('detailAvail').textContent = b.copies>0 ? 'Available' : 'Unavailable';
      document.getElementById('detailCover').innerHTML = `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display'">${escapeHtml(b.title)}</div>`;
      const hist = document.getElementById('detailHistory');
      hist.innerHTML = '';
      hist.innerHTML = `<li>John borrowed ‚Äî 2025-11-03</li><li>Mary returned ‚Äî 2025-10-22</li>`;
      document.getElementById('bookDetailPanel').style.display='flex';
      document.getElementById('bookDetailPanel').setAttribute('aria-hidden','false');
    },
    closeBookDetail(){
      const el = document.getElementById('bookDetailPanel');
      el.style.display='none';
      el.setAttribute('aria-hidden','true');
    },

    editBook(){ alert('Edit book ‚Äî implement form (demo)'); },
    checkoutBook(){ alert('Checkout flow ‚Äî implement scan / selection (demo)'); },

    showLogin(){ document.getElementById('loading').style.display='none'; document.getElementById('login').style.display='flex'; document.getElementById('app').style.display='none'; },
    showLoading(){ document.getElementById('loading').style.display='flex'; document.getElementById('login').style.display='none'; document.getElementById('app').style.display='none'; },
    signIn(){
      document.getElementById('login').style.display='none';
      document.getElementById('loading').style.display='none';
      document.getElementById('app').style.display='';
      this.init();
    },
    signOut(){ if(confirm('Sign out?')){ this.showLogin() } },

    toggleTheme(){
      document.body.classList.toggle('light-theme');
      alert('Theme toggle (demo) ‚Äî implement persistent theme in settings');
    },

    addMember(){ alert('Add member ‚Äî implement modal (demo)'); },
    exportTx(){ alert('Export CSV ‚Äî implement backend (demo)'); },

    viewMember(id){ alert('Open member ' + id + ' (demo)'); }
  };

  // small helper to avoid injecting raw HTML content
  function escapeHtml(str){
    return String(str)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;')
      .replace(/'/g,'&#39;');
  }

  window.app = app;

  document.addEventListener('DOMContentLoaded', ()=> {
    document.getElementById('loading').style.display = '';
    document.getElementById('login').style.display = 'none';
    document.getElementById('app').style.display = 'none';
  });
</script>
</body>
</html>
